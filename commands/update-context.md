---
name: taozi:update-context
description: 更新当前目录的 CLAUDE.md 上下文
argument-hint: [path] 默认当前目录
---

# 更新目录上下文

分析目录 `$ARGUMENTS`（默认 cwd），创建或增量更新 CLAUDE.md。

## 当前状态

- 目标目录: !`echo "${ARGUMENTS:-$(pwd)}"`
- 是否存在 CLAUDE.md: !`test -f "${ARGUMENTS:-$(pwd)}/CLAUDE.md" && echo "是" || echo "否"`

## 执行步骤

1. **扫描目录结构**
   - 列出主要文件和子目录
   - 识别代码文件、配置文件、测试文件

2. **分析模块职责**
   - 根据文件名和内容推断模块用途
   - 识别导出的主要功能

3. **更新策略**
   - 如果 CLAUDE.md 不存在 → 创建新文件
   - 如果已存在 → 读取现有内容，增量补充，保留用户手写内容

4. **CLAUDE.md 模板结构**
   ```markdown
   # [模块名称]

   ## 职责
   - 简述模块的核心功能

   ## 关键文件
   - `file.ts` - 描述

   ## 依赖关系
   - 依赖: xxx
   - 被依赖: xxx

   ## 注意事项
   - 开发时需要注意的点

   ## 变更记录
   - YYYY-MM-DD: 变更摘要
   ```

5. **变更记录规则**
   - 格式: `- YYYY-MM-DD: 简短摘要`
   - 追加到 `## 变更记录` 末尾
   - 同一天的多次更新合并为一条

## 重要原则

- 保持简洁，不贴代码片段
- 增量补充，不覆盖用户手写内容
- 完成后简要说明更新了什么
